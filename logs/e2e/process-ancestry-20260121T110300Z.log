== E2E Header ==
  timestamp=2026-01-21T11:03:00Z
  host=threadripperje
  os=Linux threadripperje 6.17.0-8-generic #8-Ubuntu SMP PREEMPT_DYNAMIC Fri Nov 14 21:44:46 UTC 2025 x86_64 GNU/Linux
  rano_version=0.1.0
  test_name=process-ancestry
  args=
== Setup ==
  rano=/tmp/cargo-target/debug/rano
  test_sqlite=/tmp/rano-e2e-ancestry-1279939.sqlite
== Test 1: SQLite schema includes ancestry_path column ==
== RUN 1: create db ==
  cmd=/tmp/cargo-target/debug/rano --pattern nonexistent-process-xyz --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --once --no-banner
  status=0
  output (truncated):
Summary
  connects 0
  closes 0
  active 0 (peak=0)
== RUN 2: check schema ==
  cmd=sqlite3 /tmp/rano-e2e-ancestry-1279939.sqlite .schema events
  status=0
  output (truncated):
CREATE TABLE events (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            ts TEXT NOT NULL,
            run_id TEXT,
            event TEXT NOT NULL,
            provider TEXT NOT NULL,
            pid INTEGER,
            comm TEXT,
            cmdline TEXT,
            proto TEXT,
            local_ip TEXT,
            local_port INTEGER,
            remote_ip TEXT,
            remote_port INTEGER,
            domain TEXT,
            ancestry_path TEXT,
            remote_is_private INTEGER,
            ip_version INTEGER,
            duration_ms INTEGER
        , alert INTEGER);
CREATE INDEX idx_events_ts ON events(ts);
CREATE INDEX idx_events_run_id ON events(run_id);
CREATE INDEX idx_events_provider ON events(provider);
CREATE INDEX idx_events_remote_ip ON events(remote_ip);
CREATE INDEX idx_events_domain ON events(domain);
CREATE INDEX idx_events_ancestry_path ON events(ancestry_path);
== ASSERT status ==
  expected=0
  actual=0
== ASSERT contains ==
  expected substring=ancestry_path
  PASS: SQLite events table has ancestry_path column
== Test 2: SQLite ancestry index exists ==
== RUN 3: check indices ==
  cmd=sqlite3 /tmp/rano-e2e-ancestry-1279939.sqlite .indices events
  status=0
  output (truncated):
idx_events_ancestry_path  idx_events_provider       idx_events_run_id       
idx_events_domain         idx_events_remote_ip      idx_events_ts           
== ASSERT status ==
  expected=0
  actual=0
== ASSERT contains ==
  expected substring=idx_events_ancestry_path
  PASS: ancestry_path index exists
== Test 3: Ancestry path appears in CSV export ==
== RUN 4: export csv ==
  cmd=/tmp/cargo-target/debug/rano export --format csv --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --run-id test-run-ancestry
  status=0
  output (truncated):
ts,run_id,event,provider,pid,comm,cmdline,proto,local_ip,local_port,remote_ip,remote_port,domain,ancestry_path,duration_ms
2026-01-20T12:00:00Z,test-run-ancestry,connect,anthropic,1234,claude,/usr/bin/claude,tcp,192.168.1.100,54321,104.18.32.7,443,api.anthropic.com,"init:1,systemd:500,bash:1000,claude:1234",
== ASSERT status ==
  expected=0
  actual=0
== ASSERT contains ==
  expected substring=ancestry_path
== ASSERT contains ==
  expected substring=init:1,systemd:500,bash:1000,claude:1234
  PASS: Ancestry path appears in CSV export
== Test 4: Ancestry path appears in JSONL export ==
== RUN 5: export jsonl ==
  cmd=/tmp/cargo-target/debug/rano export --format jsonl --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --run-id test-run-ancestry
  status=0
  output (truncated):
{"ancestry_path":"init:1,systemd:500,bash:1000,claude:1234","cmdline":"/usr/bin/claude","comm":"claude","domain":"api.anthropic.com","event":"connect","local_ip":"192.168.1.100","local_port":54321,"pid":1234,"proto":"tcp","provider":"anthropic","remote_ip":"104.18.32.7","remote_port":443,"run_id":"test-run-ancestry","ts":"2026-01-20T12:00:00Z"}
== ASSERT status ==
  expected=0
  actual=0
== ASSERT contains ==
  expected substring=ancestry_path
== ASSERT contains ==
  expected substring=init:1,systemd:500,bash:1000,claude:1234
  PASS: Ancestry path appears in JSONL export
== Test 5: Various ancestry path formats ==
== RUN 6: export short ==
  cmd=/tmp/cargo-target/debug/rano export --format csv --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --run-id test-run-ancestry-short
  status=0
  output (truncated):
ts,run_id,event,provider,pid,comm,cmdline,proto,local_ip,local_port,remote_ip,remote_port,domain,ancestry_path,duration_ms
2026-01-20T12:01:00Z,test-run-ancestry-short,connect,openai,2000,codex,/usr/bin/codex,tcp,192.168.1.100,54322,13.107.246.10,443,api.openai.com,"init:1,codex:2000",
== ASSERT status ==
  expected=0
  actual=0
== ASSERT contains ==
  expected substring=init:1,codex:2000
  PASS: Short ancestry path captured
== RUN 7: export deep ==
  cmd=/tmp/cargo-target/debug/rano export --format csv --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --run-id test-run-ancestry-deep
  status=0
  output (truncated):
ts,run_id,event,provider,pid,comm,cmdline,proto,local_ip,local_port,remote_ip,remote_port,domain,ancestry_path,duration_ms
2026-01-20T12:02:00Z,test-run-ancestry-deep,connect,google,3000,gemini,/usr/bin/gemini,tcp,192.168.1.100,54323,142.250.189.206,443,gemini.google.com,"init:1,systemd:100,login:200,bash:300,tmux:400,bash:500,python:600,gemini:3000",
== ASSERT status ==
  expected=0
  actual=0
== ASSERT contains ==
  expected substring=init:1,systemd:100,login:200,bash:300,tmux:400,bash:500,python:600,gemini:3000
  PASS: Deep ancestry path captured
== Test 6: Null ancestry path handled gracefully ==
== RUN 8: export null ancestry ==
  cmd=/tmp/cargo-target/debug/rano export --format csv --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --run-id test-run-no-ancestry
  status=0
  output (truncated):
ts,run_id,event,provider,pid,comm,cmdline,proto,local_ip,local_port,remote_ip,remote_port,domain,ancestry_path,duration_ms
2026-01-20T12:03:00Z,test-run-no-ancestry,connect,anthropic,4000,claude,/usr/bin/claude,tcp,192.168.1.100,54324,104.18.32.7,443,api.anthropic.com,,
== ASSERT status ==
  expected=0
  actual=0
  PASS: Null ancestry path handled gracefully in CSV
== RUN 9: export null jsonl ==
  cmd=/tmp/cargo-target/debug/rano export --format jsonl --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --run-id test-run-no-ancestry
  status=0
  output (truncated):
{"cmdline":"/usr/bin/claude","comm":"claude","domain":"api.anthropic.com","event":"connect","local_ip":"192.168.1.100","local_port":54324,"pid":4000,"proto":"tcp","provider":"anthropic","remote_ip":"104.18.32.7","remote_port":443,"run_id":"test-run-no-ancestry","ts":"2026-01-20T12:03:00Z"}
== ASSERT status ==
  expected=0
  actual=0
  PASS: Null ancestry path handled gracefully in JSONL
== Test 7: Special characters in ancestry comm names ==
== RUN 10: export special chars ==
  cmd=/tmp/cargo-target/debug/rano export --format csv --sqlite /tmp/rano-e2e-ancestry-1279939.sqlite --run-id test-run-special-chars
  status=0
  output (truncated):
ts,run_id,event,provider,pid,comm,cmdline,proto,local_ip,local_port,remote_ip,remote_port,domain,ancestry_path,duration_ms
2026-01-20T12:04:00Z,test-run-special-chars,connect,anthropic,5000,my-app_v2,/usr/bin/my-app_v2,tcp,192.168.1.100,54325,104.18.32.7,443,api.anthropic.com,"init:1,bash:100,my-app_v2:5000",
== ASSERT status ==
  expected=0
  actual=0
== ASSERT contains ==
  expected substring=my-app_v2:5000
  PASS: Special characters in process names handled
== Summary ==
  All E2E process ancestry tests passed
  Tests verified:
    - SQLite schema includes ancestry_path column
    - ancestry_path index exists for query performance
    - Ancestry path appears in CSV export
    - Ancestry path appears in JSONL export
    - Short ancestry paths work (direct from init)
    - Deep ancestry paths work (many levels)
    - Null ancestry path handled gracefully
    - Special characters in process names handled
== E2E PASS ==
  log=logs/e2e/process-ancestry-20260121T110300Z.log
  duration_seconds=0
